#!/usr/bin/env php
<?php

/**
 * TAW CLI — Theme scaffolding and management tool.
 *
 * Usage:
 *   php bin/taw make:block Hero --type=meta
 *   php bin/taw list
 *   php bin/taw help make:block
 *
 * PORTABILITY NOTE:
 * -----------------
 * This file lives in the THEME (skeleton), not in the core package.
 * It's the glue between the two: it knows the theme root (dirname(__DIR__))
 * and passes it to each CLI command via constructor injection.
 *
 * The CLI commands live in vendor/taw/core/ and have NO idea where the
 * theme is — they just use whatever $themeDir they receive.
 *
 * This separation means:
 *   - Core commands can be updated via `composer update taw/core`
 *   - The theme root is always correct regardless of core's location
 *   - WordPress doesn't need to be loaded
 */

// Theme root = the directory containing bin/
$themeDir = dirname(__DIR__);

// Find the Composer autoloader
$autoload = $themeDir . '/vendor/autoload.php';

if (!file_exists($autoload)) {
    fwrite(STDERR, "Run 'composer install' first.\n");
    exit(1);
}

require $autoload;

// Tell the Framework where the theme is (for any code that needs it in CLI context)
TAW\Core\Framework::setThemeRoot($themeDir);

use Symfony\Component\Console\Application;
use TAW\CLI\MakeBlockCommand;
use TAW\CLI\ExportBlockCommand;
use TAW\CLI\ImportBlockCommand;

$app = new Application('TAW CLI', '1.0.0');

// Inject the theme root into each command
// This is dependency injection — the command doesn't know where it lives,
// the caller (this file) tells it where to operate.
$app->add(new MakeBlockCommand($themeDir));
$app->add(new ExportBlockCommand($themeDir));
$app->add(new ImportBlockCommand($themeDir));

$app->run();
